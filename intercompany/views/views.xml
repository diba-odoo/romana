<odoo>
    <data>
        <!-- attrs="{'invisible' : [('state', '=', 'draft')]}" -->
        <record id="intercompany_form_view" model="ir.ui.view">
            <field name="name">intercompany.view.form</field>
            <field name="model">inter.company</field>
            <field name="arch" type="xml">
                <form name="inter_company" string="InterCompany ">
                    <header>

                        <button name="post_entry" string="Submit" type="object" class="oe_highlight" states="draft" groups="account.group_account_manager"/>
                        <button name="cancel_entry" string="Cancel" type="object" states="transfer" groups="account.group_account_manager"/>
                        <button class="oe_stat_button" string="Generate Entries" states="draft"  icon="fa-book" type="object" name="generate_entries"/>

                        <field name="state" widget="statusbar" readonly="True"/>

                    </header>
                    <sheet>

                        <div class="oe_button_box" name="button_box">
                            <button class="oe_stat_button"  icon="fa-bars" type="object" name="action_from_move">
                                <field name="move_from_count" widget="statinfo" string="Sender JV"/>
                            </button>
                            <button class="oe_stat_button"  icon="fa-bars" type="object" name="action_to_move">
                                <field name="move_to_count" widget="statinfo" string="Receiver JV"/>
                            </button>

                        </div>
                        <widget name="web_ribbon" title="Transfer"  bg_color="bg-success"  attrs="{'invisible': [('state','!=','transfer')]}"/>
                        <widget name="web_ribbon" title="Canceled"  bg_color="bg-danger"  attrs="{'invisible': [('state','!=','cancel')]}"/>


                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h2>
                                <field name="name"/>
                            </h2>
                        </div>

                        <group string="Inter-Company Details" col="4" >
                            <field name="company_id_from" class="oe_inline" attrs="{'readonly' : [('state', 'in', ['cancel','transfer'])]}" options="{'color_field': 'color', 'no_create_edit': True}"/>
                            <field name="journal_id_from" class="oe_inline" attrs="{'readonly' : [('state', 'in', ['cancel','transfer'])]}" options="{'color_field': 'color', 'no_create_edit': True}"/>
                            <field name="date" attrs="{'readonly' : [('state', 'in', ['cancel','transfer'])]}"/>
                            <field name="user_id" attrs="{'readonly' : [('state', '!=', 'draft')]}"/>
                            <field name="payment_type" widget="radio" attrs="{'readonly' : [('state', '!=', 'draft')]}"/>
                            <field name="currency_id" attrs="{'readonly' : [('state', '!=', 'draft')]}"/>
                            <field name="amount" attrs="{'readonly' : [('state', '!=', 'draft')]}"/>
                            <field name="ref" attrs="{'readonly' : [('state', 'in', ['cancel','transfer'])]}"/>
                            <field name="purpose" attrs="{'readonly' : [('state', 'in', ['cancel','transfer'])]}"/>
                        </group>
                        <group string="Sender Info">


                        </group>
                        <group >
                            <field name="inter_company_from_ids" nolabel="1" attrs="{'readonly' : [('state', '!=', 'draft')]}">
                                <tree editable="bottom">
                                    <field name="account_id" options="{'color_field': 'color', 'no_create_edit': True}"/>
                                    <field name="partner_id" options="{'color_field': 'color', 'no_create_edit': True}"/>
                                    <field name="label"/>
                                    <field name="analytic_account_id" options="{'color_field': 'color', 'no_create_edit': True}"/>
                                    <field name="currency_id" />
                                    <field name="debit" sum="Total Debit"/>
                                    <field name="credit" sum="Total Credit"/>
                                </tree>
                            </field>
                        </group>

                        <!--To Company-->
                        <group>
                            <group string="Receiver Info" >
                                <field name="company_id_to" class="oe_inline" readonly="1" options="{'color_field': 'color', 'no_create_edit': True}"/>
                                <field name="journal_id_to" class="oe_inline" readonly="1" options="{'color_field': 'color', 'no_create_edit': True}"/>

                            </group>

                        </group>
                        <group>
                            <field name="inter_company_to_ids" edit="0" nolabel="1" attrs="{'readonly' : [('state', '!=', 'draft')]}">
                                <tree editable="bottom">
                                    <field name="account_id" options="{'color_field': 'color', 'no_create_edit': True}"/>
                                    <field name="partner_id" options="{'color_field': 'color', 'no_create_edit': True}"/>
                                    <field name="label"/>
                                    <field name="analytic_account_id" options="{'color_field': 'color', 'no_create_edit': True}"/>
                                    <field name="currency_id" />
                                    <field name="debit" sum="Total Debit"/>
                                    <field name="credit" sum="Total Credit"/>
                                </tree>
                            </field>
                        </group>

                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="seq_inter_company_transaction" model="ir.sequence">
            <field name="name">InterCompanySequence</field>
            <field name="code">inter.company.code</field>
            <field name="prefix">ICT/JV/%(year)s/</field>
            <field name="padding">5</field>
            <field name="number_next">1</field>
            <field name="number_increment">1</field>
            <field name="company_id" eval="False"/>
        </record>

        <record id="view_account_journal_inherit" model="ir.ui.view">
            <field name="name">view.account.journal.form.inherit</field>
            <field name="model">account.journal</field>
            <field name="inherit_id" ref="account.view_account_journal_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='type']" position="after">
                    <field name="is_intercompany"/>
                </xpath>

                <notebook>
                    <page string="Inter-Company" attrs="{'invisible': [('is_intercompany','!=',True)]}">
                        <field name="is_intercompany" invisible="1"/>
                        <group string="Our main Accounts" col="4">
                            <field name="our_payable_id" attrs="{'invisible': [('is_intercompany','!=',True)]}"/>
                            <field name="our_receivable_id" attrs="{'invisible': [('is_intercompany','!=',True)]}"/>
                        </group>

                        <group string="Corporate/Other party Accounts" col="4">
                            <field name="intercompany_company_id" attrs="{'invisible': [('is_intercompany','!=',True)],'required': [('is_intercompany','=',True)]}"/>
                            <field name="intercompany_journal_id" attrs="{'invisible': [('is_intercompany','!=',True)],'required': [('is_intercompany','=',True)]}"/>
                            <field name="inter_company_current_asset_id" attrs="{'invisible': [('is_intercompany','!=',True)],'required': [('is_intercompany','=',True)]}"/>
                            <field name="inter_company_payable_id" attrs="{'invisible': [('is_intercompany','!=',True)]}"/>
                            <field name="inter_company_receivable_id" attrs="{'invisible': [('is_intercompany','!=',True)]}"/>
                        </group>



                    </page>
                </notebook>


            </field>
        </record>

        <record id="view_account_move_inherit" model="ir.ui.view">
            <field name="name">view.account.move.ICT.form.inherit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='ref']" position="after">
                    <!--<group>-->
                    <field name="is_ict" invisible="1"/>
                    <field name="inter_comp_id" attrs="{'invisible':[('is_ict','=',False)]}"/>
                    <!--</group>-->
                </xpath>


            </field>
        </record>

        <record id="view_account_payment_inherit" model="ir.ui.view">
            <field name="name">view.account.payment.form.inherit</field>
            <field name="model">account.payment</field>
            <field name="inherit_id" ref="account.view_account_payment_form"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="is_inter_company" />
                </xpath>
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button type="object" name="action_intercompany_view" class="oe_stat_button"
                            icon="fa-list-alt" string="Inter-company JV" attrs="{'invisible': ['|',('is_inter_company','!=',True),('state','!=','posted')]}">
                    </button>
                </xpath>

            </field>
        </record>

        <record id="view_intercompany_tree" model="ir.ui.view">
            <field name="name">view.intercompany.tree</field>
            <field name="model">inter.company</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="date"/>
                    <field name="ref"/>
                    <field name="company_id_from"/>
                    <field name="company_id_to"/>
                    <field name="amount"/>
                    <field name="state" widget='badge' decoration-info="state == 'draft'" decoration-success="state == 'transfer'" decoration-danger="state == 'cancel'"/>
                </tree>
            </field>
        </record>

        <record id="view_intercompany_search" model="ir.ui.view">
            <field name="name">view.intercompany.search</field>
            <field name="model">inter.company</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="date"/>
                    <field name="ref"/>
                    <field name="company_id_from"/>
                    <field name="company_id_to"/>
                    <group expand="0" string="Group By">
                        <!--                        <filter name="ict_type" string="Inter Company Type" domain="[]" context="{'group_by':'ict_type'}"/>-->
                        <filter name="company_id_from" string="Sender Company" domain="[]" context="{'group_by':'company_id_from'}"/>
                        <filter name="company_id_to" string="Receiver Company" domain="[]" context="{'group_by':'company_id_to'}"/>
                        <filter name="state" string="State" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="view_intercompany_kanban">
            <field name="name">inter.company.kanban</field>
            <field name="model">inter.company</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile">
                    <field name="name"/>
                    <field name="date"/>
                    <field name="ref"/>
                    <field name="company_id_from"/>
                    <field name="company_id_to"/>
                    <field name="state"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_record_top mb16">
                                    <div class="o_kanban_record_headings mt4">
                                        <strong class="o_kanban_record_title"><span><t t-esc="record.name.value"/></span></strong>
                                    </div>
                                </div>
                                <div>
                                    <strong>From: <field name="company_id_from"/></strong><br></br>
                                    <strong>To: <field name="company_id_to"/></strong>
                                </div>
                                <div class="o_kanban_record_bottom">
                                    <div class="oe_kanban_bottom_left text-success">
                                        <span><t t-esc="record.date.value"/></span>
                                    </div>
                                    <div class="oe_kanban_bottom_right">
                                        <field name="state" widget="label_selection" options="{'classes': {'draft': 'default', 'cancel': 'danger', 'transfer': 'success'}}"/>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>


        <record id="intercompany_action_window" model="ir.actions.act_window">
            <field name="name">InterCompany Transaction</field>
            <field name="res_model">inter.company</field>
            <field name="view_mode">tree,form</field>
        </record>



        <menuitem id="intercompany_root"  name="Inter-Company Transaction" sequence="100" parent="account.menu_finance_entries_accounting_miscellaneous"
                  action="intercompany_action_window" groups="account.group_account_manager,account.group_account_user"/>


    </data>
</odoo>
